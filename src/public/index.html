<!DOCTYPE html>
<html>

<head>
    <title>v√©rnyomi</title>
</head>

<body>
    <button id="start-session" onclick="startSession()">start</button>
    <div id="session" style="display: none;">
        <h1>New Session</h1>
        <input type="text" id="session-comment" title="comment" placeholder="any comment?">
        <button id="save-session" onclick="saveSession()" title="continue to entering measurements">start</button>
    </div>
    <div id="measurements" style="display: none;">
        <h1>New Measurement</h1>
        <table>
            <tr>
                <th>sys</th>
                <th>dia</th>
                <th>puls</th>
                <!-- <th>comment</th> -->
            </tr>
            <tr>
                <td><input type="number" id="sys" placeholder="Sys"></td>
                <td><input type="number" id="dia" placeholder="Dia"></td>
                <td>
                    <input type="number" id="puls" placeholder="puls">
                    <button id="save-measurment" onclick="saveMeasurement()">next</button>
                </td>
                <!-- <td><input type="text" id="comment" placeholder="Comment"></td> -->
            </tr>
    </div>

    <script>
        function startSession() {
            document.getElementById('start-session').disabled = true;
            document.getElementById('session').style.display = 'block';
            document.getElementById('measurements').style.display = 'none';
            // localStorage.setItem('rowCount', 0);
        }
        function saveSession() {
            fetch('/start-session', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    comment: document.getElementById('session-comment').value
                })
            })
                .then(response => response.json())
                .then(data => {
                    console.log(data);
                    document.getElementById('session').style.display = 'none';
                    document.getElementById('measurements').style.display = 'block';
                    localStorage.setItem('sessionId', data.sessionId);
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        }
        function saveMeasurement() {
            fetch('/save-measurement', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    sessionId: localStorage.getItem('sessionId'),
                    sys: document.getElementById('sys').value,
                    dia: document.getElementById('dia').value,
                    puls: document.getElementById('puls').value,
                    comment: document.getElementById('comment')?.value ?? ""
                })
            })
                .then(response => response.json())
                .then(data => {
                    console.log(data);
                    // Find the table element
                    const table = document.querySelector('table');

                    // Find last row
                    // const rowCount = localStorage.getItem('rowCount');
                    const lastRow = table.rows[table.rows.length - 1];
                    // Find cells and replace the input controls by values from the response

                    // freeze content
                    lastRow.cells[0].innerHTML= document.getElementById('sys').value;
                    lastRow.cells[1].innerHTML= document.getElementById('dia').value;
                    lastRow.cells[2].innerHTML= document.getElementById('puls').value;
                    // lastRow.cells[3].innerHTML= document.getElementById('comment').value;

                    // Create a new row
                    const newRow = table.insertRow();

                    // Create cells for each property from the response
                    const sysCell = newRow.insertCell();
                    const diaCell = newRow.insertCell();
                    const pulsCell = newRow.insertCell();
                    // const commentCell = newRow.insertCell();

                    // Set the values of the cells
                    sysCell.innerHTML = '<input type="number" id="sys" placeholder="Sys">';
                    diaCell.innerHTML = '<input type="number" id="dia" placeholder="Dia">';
                    pulsCell.innerHTML = '<input type="number" id="puls" placeholder="puls"><button id="save-measurment" onclick="saveMeasurement()">next</button>';
                    // commentCell.innerHTML = '<input type="text" id="comment" placeholder="Comment">';
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        }
    </script>
</body>

</html>